# Update Notice

## Update 2021/4/16

完成 Buffer_Lab，以及填坑上周说完成一个显示链表分配器(详见week2/my_malloc)。BufferLab不是很难，写了一个蹩脚的分配器感觉还是挺不错的，虽然不是很完备但是基本的分配功能还是有的。



## Update 2021/4/17

+   第八章异常控制流的部分阅读笔记
+   archlab

### 记录一下archlab: PartA

PartA要求用一个完备的Y86-86汇编实现给定的三个程序。一开始不是很习惯，看看书后发现这个语法和x86很类似更为简单，还是比较容易上手的。

第一个程序是一个对链表求和的程序，很简单用loop循环几次即可(详见sum.ys)

执行结果：

```assembly
Stopped in 26 steps at PC = 0x13.  Status 'HLT', CC Z=1 S=0 O=0
Changes to registers:
%rax:	0x0000000000000000	0x0000000000000cba
%rsp:	0x0000000000000000	0x0000000000000200
%r10:	0x0000000000000000	0x0000000000000c00

Changes to memory:
0x01f0:	0x0000000000000000	0x000000000000005b
0x01f8:	0x0000000000000000	0x0000000000000013
```



第二个要求用递归求和，这就需要用到栈了。顶多写写shellcode，不需要考虑栈的开辟，回收与储存。这次就算填个坑了，仿照一个普通函数的汇编格式，写出基本的函数开头与结尾：

````assembly
pushq %rbp
rrmovq %rsp, %rbp
irmovq $0x20, %r8
subq %r8, %rsp
....
...
rrmovq %rbp, %rsp
popq %rbp
ret
````

然后每一次递归把vla放在对应栈帧的特定偏移即可

执行结果

```assembly
Stopped in 73 steps at PC = 0x21.  Status 'HLT', CC Z=0 S=0 O=0
Changes to registers:
%rax:	0x0000000000000000	0x0000000000000cba
%rbx:	0x0000000000000000	0x000000000000000a
%rsp:	0x0000000000000000	0x00000000000002e0
%rbp:	0x0000000000000000	0x0000000000000300
%r8:	0x0000000000000000	0x0000000000000c00
%r10:	0x0000000000000000	0x0000000000000020

Changes to memory:
0x0210:	0x0000000000000000	0x0000000000000240
0x0218:	0x0000000000000000	0x00000000000000c2
0x0238:	0x0000000000000000	0x0000000000000c00
0x0240:	0x0000000000000000	0x0000000000000270
0x0248:	0x0000000000000000	0x00000000000000c2
0x0268:	0x0000000000000000	0x00000000000000b0
0x0270:	0x0000000000000000	0x00000000000002a0
0x0278:	0x0000000000000000	0x00000000000000c2
0x0298:	0x0000000000000000	0x000000000000000a
0x02a0:	0x0000000000000000	0x00000000000002d0
0x02a8:	0x0000000000000000	0x000000000000007b
0x02d0:	0x0000000000000000	0x0000000000000300
0x02d8:	0x0000000000000000	0x0000000000000021
```



第三个要求用指针的来copy数据以及求异或值，也比较简单(详见copy.ys)

执行结果

```assembly
Stopped in 41 steps at PC = 0x13.  Status 'HLT', CC Z=1 S=0 O=0
Changes to registers:
%rax:	0x0000000000000000	0x0000000000000cba
%rsp:	0x0000000000000000	0x0000000000000200
%rsi:	0x0000000000000000	0x0000000000000048
%rdi:	0x0000000000000000	0x0000000000000030
%r8:	0x0000000000000000	0x0000000000000008
%r9:	0x0000000000000000	0x0000000000000001
%r10:	0x0000000000000000	0x0000000000000c00

Changes to memory:
0x0030:	0x0000000000000111	0x000000000000000a
0x0038:	0x0000000000000222	0x00000000000000b0
0x0040:	0x0000000000000333	0x0000000000000c00
0x01f0:	0x0000000000000000	0x000000000000006f
0x01f8:	0x0000000000000000	0x0000000000000013
```

